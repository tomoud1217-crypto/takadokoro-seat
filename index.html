<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ç”°æ‰€å•†åº— å¸­ç®¡ç†</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    .seat {
      padding: 30px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .available { background: green; }
    .occupied { background: red; }
    .reserved { background: blue; }
    .cleaning { background: orange; }
  </style>
</head>
<body>

<h1>ç”°æ‰€å•†åº— å¸­ç®¡ç†</h1>

<div class="grid" id="seats"></div>

<script>
  // ğŸ”¹ ã“ã“ã‚’ã‚ãªãŸã®Supabaseæƒ…å ±ã«ç½®ãæ›ãˆã¦ãã ã•ã„
  const supabaseUrl = "https://egpyngraztknzuxryoxr.supabase.co"; // Project URL
  const supabaseKey = "sb_publishable_19LkgpFUb0H2sC_ZdcAplw_YfJYil2D"; // anon key
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  // ğŸ”¹ å¸­æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€
  async function loadSeats() {
    const { data, error } = await supabase.from("seats").select("*");
    if(error){
      console.error("Supabase error:", error);
      alert("å¸­æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    const container = document.getElementById("seats");
    container.innerHTML = "";

    data.forEach(seat => {
      const div = document.createElement("div");
      div.className = "seat " + seat.status;
      div.innerText = seat.name;
      div.onclick = () => changeStatus(seat);
      container.appendChild(div);
    });
  }

  // ğŸ”¹ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡æ›¿
  async function changeStatus(seat) {
    const statuses = ["available", "occupied", "reserved", "cleaning"];
    const next = statuses[(statuses.indexOf(seat.status)+1)%4];

    const { error } = await supabase.from("seats")
      .update({ status: next })
      .eq("id", seat.id);

    if(error){
      console.error("Supabase update error:", error);
      alert("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      return;
    }

    loadSeats();
  }

  loadSeats();
</script>

</body>
</html>
